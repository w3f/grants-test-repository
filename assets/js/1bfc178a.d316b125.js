"use strict";(self.webpackChunkgrants=self.webpackChunkgrants||[]).push([[3252],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>c});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=p(a),c=i,h=d["".concat(s,".").concat(c)]||d[c]||u[c]||r;return a?n.createElement(h,l(l({ref:t},m),{},{components:a})):n.createElement(h,l({ref:t},m))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},85713:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var n=a(83117),i=(a(67294),a(3905));const r={},l="`wasm-opt` for Rust",o={unversionedId:"Applications/wasm-opt-for-rust",id:"Applications/wasm-opt-for-rust",title:"`wasm-opt` for Rust",description:"- Team Name: Common Orbit LLC",source:"@site/docs/Applications/wasm-opt-for-rust.md",sourceDirName:"Applications",slug:"/Applications/wasm-opt-for-rust",permalink:"/grants-test-repository/docs/Applications/wasm-opt-for-rust",draft:!1,editUrl:"https://github.com/w3f/grants-test-repository/edit/master/docs/Applications/wasm-opt-for-rust.md",tags:[],version:"current",lastUpdatedBy:"Sebastian M\xfcller",lastUpdatedAt:1668007993,formattedLastUpdatedAt:"Nov 9, 2022",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Avoiding Rust Deadlocks via Visualizing Lifetime",permalink:"/grants-test-repository/docs/Applications/visualize_rust_lifetime"},next:{title:"WebAssembly Runtimes Fuzzing (WARF)",permalink:"/grants-test-repository/docs/Applications/wasm_runtimes_fuzzing"}},s={},p=[{value:"Project Overview \ud83d\udcc4",id:"project-overview-",level:2},{value:"Overview",id:"overview",level:3},{value:"Project Details",id:"project-details",level:3},{value:"Ecosystem Fit",id:"ecosystem-fit",level:3},{value:"Prior Work and Alternatives",id:"prior-work-and-alternatives",level:4},{value:"Team \ud83d\udc65",id:"team-",level:2},{value:"Team members",id:"team-members",level:3},{value:"Contact",id:"contact",level:3},{value:"Legal Structure",id:"legal-structure",level:3},{value:"Team&#39;s experience",id:"teams-experience",level:3},{value:"Team Code Repos",id:"team-code-repos",level:3},{value:"Team LinkedIn Profiles (if available)",id:"team-linkedin-profiles-if-available",level:3},{value:"Development Status \ud83d\udcd6",id:"development-status-",level:2},{value:"Development Roadmap \ud83d\udd29",id:"development-roadmap-",level:2},{value:"Overview",id:"overview-1",level:3},{value:"Milestone 1 \u2014 Proof of Concept",id:"milestone-1--proof-of-concept",level:3},{value:"Milestone 2 \u2014 Integration",id:"milestone-2--integration",level:3},{value:"Future Plans",id:"future-plans",level:2},{value:"Appendix: The <code>wasm-opt</code> installation experience",id:"appendix-the-wasm-opt-installation-experience",level:2}],m={toc:p};function u(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"wasm-opt-for-rust"},(0,i.kt)("inlineCode",{parentName:"h1"},"wasm-opt")," for Rust"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Team Name:")," Common Orbit LLC"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Payment Address:")," (Ethereum DAI) 0x2de31E52E24Df0588C64B27657D4F75e5462adEf"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"https://github.com/w3f/Grants-Program/tree/master#level_slider-levels"},"Level"),":")," 2")),(0,i.kt)("h2",{id:"project-overview-"},"Project Overview \ud83d\udcc4"),(0,i.kt)("h3",{id:"overview"},"Overview"),(0,i.kt)("p",null,"This project makes the ",(0,i.kt)("a",{parentName:"p",href:"https://rustwasm.github.io/book/reference/tools.html#wasm-opt--a-hrefhttpsgithubcomwebassemblybinaryenrepositorya"},(0,i.kt)("inlineCode",{parentName:"a"},"wasm-opt"))," tool more accessible to Rust programmers.\n",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," is a ",(0,i.kt)("a",{parentName:"p",href:"https://webassembly.org/"},"WebAssembly")," optimizer and is required by most software toolchains that\nproduce WebAssembly binaries."),(0,i.kt)("p",null,"This project is to package ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," as a cargo crate,\nso that it can be installed by typing"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("inlineCode",{parentName:"p"},"cargo install wasm-opt"))),(0,i.kt)("p",null,"Additionally, it will provide a Rust API so that toolchain developers may,\nif they desire, call ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," programmatically,\nso that their users are not required to manually install the tool."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," is a part of the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/WebAssembly/binaryen"},"binaryen")," toolset, written in C++.\nIt is almost universally required by all toolchains that compile to WebAssembly.\nIt is required by Parity's ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/paritytech/cargo-contract"},(0,i.kt)("inlineCode",{parentName:"a"},"cargo-contract"))," tool for ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/paritytech/ink"},"ink!")," development."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"This tool can not be aquired in the way Rust programmers expect ","\u2014"," with ",(0,i.kt)("inlineCode",{parentName:"strong"},"cargo install"),"."),"\nInstallation of the tool is system-dependent.\nMany system package managers have some version of it,\nin some cases an old version;\nor it can be downloaded in binary form for most platforms, from GitHub,\nin which case it has to be extracted and added to the environment ",(0,i.kt)("inlineCode",{parentName:"p"},"PATH")," variable in an ad-hoc way."),(0,i.kt)("p",null,"In ",(0,i.kt)("a",{parentName:"p",href:"#appendix-the-wasm-opt-installation-experience"},"our personal experience"),", aquiring this tool was a minor, but needless, barrier, to programming with ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/paritytech/ink"},"ink!"),"."),(0,i.kt)("p",null,"In the course of this grant ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract")," will receive pull requests\nto optionally enable both the following:"),(0,i.kt)("p",null,"1) recommend installation via ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo install wasm-opt"),"\n2) use ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," via API and not require installation."),(0,i.kt)("h3",{id:"project-details"},"Project Details"),(0,i.kt)("p",null,"Note that although ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," comes from the binaryen suite of tools,\nthis project is only focused on ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt"),".\nAll other binaryen tools are out of scope.\nIf this project is successful and there is demand,\nfuture work can extend the technique to the rest of binaryen."),(0,i.kt)("p",null,"This project is technically straightforward.\nThe main complication is that within ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo")," it is not possible to install binaries that were not produced\ndirectly by the Rust compiler.\nThis means that it is not possible to simply build ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," in a build script, then have ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo")," install it."),(0,i.kt)("p",null,"This is the basic approach we will take, for the executable:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt-sys")," crate builds the C++ code for ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")),(0,i.kt)("li",{parentName:"ul"},"the C++ source is built with only the C++ compiler all Rust users will have installed,\nno CMake or other build-system dependency"),(0,i.kt)("li",{parentName:"ul"},"the C++ ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," source is minimally-patched to export its ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," function with C ABI to be called from Rust"),(0,i.kt)("li",{parentName:"ul"},"a ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," crate contains a tiny Rust module that calls the C ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," main function")),(0,i.kt)("p",null,"We have prototyped the project sufficiently to believe the described approach will succeed."),(0,i.kt)("p",null,"For the library bindings:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt-sys")," will export low-level Rust bindings with the help of one\nof the common C++-integration crates, likely ",(0,i.kt)("inlineCode",{parentName:"li"},"cxx")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," will provide an idiomatic Rust wrapper that exposes the necessary ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," options programmatically")),(0,i.kt)("p",null,"We will also deliver the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Full README and API documentation"),(0,i.kt)("li",{parentName:"ul"},"Basic regression tests for the binary and library"),(0,i.kt)("li",{parentName:"ul"},"CI for the platforms",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"aarch64-apple-darwin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"aarch64-unknown-linux-gnu")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"i686-pc-windows-msvc")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"i686-unknown-linux-gnu")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x86_64-apple-darwin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x86_64-pc-windows-msvc")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x86_64-unknown-linux-gnu")))),(0,i.kt)("li",{parentName:"ul"},"Pull requests adding optional support for the ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," crate to",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cargo-contract"),", the ink! build tool"))),(0,i.kt)("li",{parentName:"ul"},"One blog post about the tool and its development, at ",(0,i.kt)("a",{parentName:"li",href:"https://brson.github.io"},"https://brson.github.io"))),(0,i.kt)("p",null,"We will not include the following ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," capabilities in the library bindings:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Fuzzing. ",(0,i.kt)("inlineCode",{parentName:"li"},"wasm-opt")," has multiple options related to fuzz testing the output\nmodule. We are aware of no potential clients for this feature. Including these\nfuzzing features requires code duplication in Rust, for additional maintenance\nburden and questionable benefit.")),(0,i.kt)("h3",{id:"ecosystem-fit"},"Ecosystem Fit"),(0,i.kt)("p",null,"This project is immediately useful to all Rust developers that build for wasm."),(0,i.kt)("p",null,"It is more specifically useful to developers of Rust-based toolchains that target wasm,\nand most specifically the ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract")," tool used to compile ink! programs.\nIt is probably relevant to authors of Substrate runtimes as well,\nthough we do not have that experience yet."),(0,i.kt)("h4",{id:"prior-work-and-alternatives"},"Prior Work and Alternatives"),(0,i.kt)("p",null,"There are existing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pepyakin/binaryen-rs"},"Rust bindings for binaryen"),".\nAs-is they don't provide a route to installing ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," via cargo.\nIt is unclear if they provide the APIs needed to expose ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," programmatically,\nthough they probably do.\nThese bindings appear to rely on CMake to build.\nWe do not expect to use them directly, but may reference them during development."),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/bytecodealliance/cargo-wasi"},(0,i.kt)("inlineCode",{parentName:"a"},"cargo-wasi"))," tool takes a ",(0,i.kt)("a",{parentName:"p",href:"https://bytecodealliance.github.io/cargo-wasi/wasm-opt.html#which-wasm-opt-executed"},"different strategy")," to acquiring ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt"),".\nIt automatically downloads the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," binary, presumably from the official releases.\nOther wasm toolchains like ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract")," could follow a similar strategy,\npossibly by extracting the existing logic from ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-wasi"),"."),(0,i.kt)("h2",{id:"team-"},"Team \ud83d\udc65"),(0,i.kt)("h3",{id:"team-members"},"Team members"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Team lead:")," ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/brson"},"Brian Anderson")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Team member:")," ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/aimeedeer"},"Aimee Zhu"))),(0,i.kt)("h3",{id:"contact"},"Contact"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Contact Name:")," Brian Anderson"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Contact Email:")," ",(0,i.kt)("a",{parentName:"li",href:"mailto:andersrb@gmail.com"},"andersrb@gmail.com")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Website:")," ",(0,i.kt)("a",{parentName:"li",href:"https://brson.github.io"},"https://brson.github.io"))),(0,i.kt)("h3",{id:"legal-structure"},"Legal Structure"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Registered Address:")," 16192 Coastal Highway, Lewes, Delaware 19958"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Registered Legal Entity:")," Common Orbit LLC")),(0,i.kt)("h3",{id:"teams-experience"},"Team's experience"),(0,i.kt)("p",null,"The team lead is one of the original authors of the Rust programming language,\nwith 12 years of Rust experience.\nThey have performed Rust work for Mozilla, Reddit, PingCAP, Solana, MobileCoin, Parity, and Nervos.\nBoth team members are maintainers of the ",(0,i.kt)("a",{parentName:"p",href:"https://rustinblockchain.org/"},"Rust in Blockchain")," newsletter."),(0,i.kt)("h3",{id:"team-code-repos"},"Team Code Repos"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/brson/wasm-opt-rs"},"https://github.com/brson/wasm-opt-rs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/brson"},"https://github.com/brson")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/aimeedeer"},"https://github.com/aimeedeer"))),(0,i.kt)("h3",{id:"team-linkedin-profiles-if-available"},"Team LinkedIn Profiles (if available)"),(0,i.kt)("p",null,"N/A"),(0,i.kt)("h2",{id:"development-status-"},"Development Status \ud83d\udcd6"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/brson/wasm-opt-rs"},"https://github.com/brson/wasm-opt-rs")),(0,i.kt)("p",null,"We have created the initial project layout and investigated the feasibility of building the binaryen codebase using only the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.rs/cc/latest/cc/"},(0,i.kt)("inlineCode",{parentName:"a"},"cc"))," crate,\nas well as the feasibility of trivially calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," function from Rust as described."),(0,i.kt)("p",null,"We have reserved the ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt-sys")," crate names on crates.io."),(0,i.kt)("h2",{id:"development-roadmap-"},"Development Roadmap \ud83d\udd29"),(0,i.kt)("h3",{id:"overview-1"},"Overview"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Total Estimated Duration:")," 3-4 months"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Full-Time Equivalent (FTE):"),"  0.4"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Total Costs:")," 30,000 USD")),(0,i.kt)("p",null,"This will be a part time effort.\nI have divided this into two logical milestones,\nthough in reality the work will overlap."),(0,i.kt)("h3",{id:"milestone-1--proof-of-concept"},"Milestone 1 \u2014 Proof of Concept"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Estimated duration:")," 1-2 month"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"FTE:"),"  0.4"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Costs:")," 15,000 USD")),(0,i.kt)("p",null,"During this phase we will prove the concept and produce a ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," Rust binary and API."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"right"},"Number"),(0,i.kt)("th",{parentName:"tr",align:null},"Deliverable"),(0,i.kt)("th",{parentName:"tr",align:null},"Specification"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0a."),(0,i.kt)("td",{parentName:"tr",align:null},"License"),(0,i.kt)("td",{parentName:"tr",align:null},"MIT / Apache-2.0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0b."),(0,i.kt)("td",{parentName:"tr",align:null},"Documentation"),(0,i.kt)("td",{parentName:"tr",align:null},"Basic README.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0c."),(0,i.kt)("td",{parentName:"tr",align:null},"Testing Guide"),(0,i.kt)("td",{parentName:"tr",align:null},"Manual smoke testing on Linux, Windows, and MacOS, x86_64 and ARM.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0d."),(0,i.kt)("td",{parentName:"tr",align:null},"Docker"),(0,i.kt)("td",{parentName:"tr",align:null},"Docker is not required for this project.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"1."),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"wasm-opt")," binary"),(0,i.kt)("td",{parentName:"tr",align:null},"Produce a ",(0,i.kt)("inlineCode",{parentName:"td"},"wasm-opt")," binary that can be built by cargo but is otherwise identical to stock ",(0,i.kt)("inlineCode",{parentName:"td"},"wasm-opt"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"2."),(0,i.kt)("td",{parentName:"tr",align:null},"APIs"),(0,i.kt)("td",{parentName:"tr",align:null},"Write an idiomatic, but possibly incomplete, Rust API for loading wasm, optimizing it, and writing it again.")))),(0,i.kt)("h3",{id:"milestone-2--integration"},"Milestone 2 \u2014 Integration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Estimated duration:")," 1-2 month"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"FTE:"),"  0.4"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Costs:")," 15,000 USD")),(0,i.kt)("p",null,"During this phase we will prepare the project for production and integrate it with ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"right"},"Number"),(0,i.kt)("th",{parentName:"tr",align:null},"Deliverable"),(0,i.kt)("th",{parentName:"tr",align:null},"Specification"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0a."),(0,i.kt)("td",{parentName:"tr",align:null},"License"),(0,i.kt)("td",{parentName:"tr",align:null},"MIT / Apache-2.0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0b."),(0,i.kt)("td",{parentName:"tr",align:null},"Documentation"),(0,i.kt)("td",{parentName:"tr",align:null},"Full README and API docs.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0c."),(0,i.kt)("td",{parentName:"tr",align:null},"Testing Guide"),(0,i.kt)("td",{parentName:"tr",align:null},"Basic integration tests for both binary and library.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0d."),(0,i.kt)("td",{parentName:"tr",align:null},"Docker"),(0,i.kt)("td",{parentName:"tr",align:null},"Docker is not required for this project.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0e."),(0,i.kt)("td",{parentName:"tr",align:null},"Article"),(0,i.kt)("td",{parentName:"tr",align:null},"Publish a technical blog post about how the project was developed and indicating it is available for use.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"1."),(0,i.kt)("td",{parentName:"tr",align:null},"APIs"),(0,i.kt)("td",{parentName:"tr",align:null},"Ensure the APIs expose all the ",(0,i.kt)("inlineCode",{parentName:"td"},"wasm-opt")," options, and can be easily integrated into tools like ",(0,i.kt)("inlineCode",{parentName:"td"},"cargo-contract"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"2."),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"cargo-contract")," integration"),(0,i.kt)("td",{parentName:"tr",align:null},"Submit a PR to ",(0,i.kt)("inlineCode",{parentName:"td"},"cargo-contract")," that integrates the ",(0,i.kt)("inlineCode",{parentName:"td"},"wasm-opt")," crate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"3."),(0,i.kt)("td",{parentName:"tr",align:null},"CI"),(0,i.kt)("td",{parentName:"tr",align:null},"Set up CI for all indicated platforms.")))),(0,i.kt)("h2",{id:"future-plans"},"Future Plans"),(0,i.kt)("p",null,"Upon completion of this project we will pursue a maintainence grant\nto supply hourly funds for maintenance of this project.\nWe expect maintenance to be minimal,\nprimarily updating the code and making new releases to match upstream binaryen releases,\nand responding to issue reports."),(0,i.kt)("p",null,"We are interested in pursuing a pure-Rust alternative to ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," with a limited\nfocus of quickly shrinking wasm binaries."),(0,i.kt)("p",null,"We expect to pursue additional projects related to ink! and Substrate."),(0,i.kt)("h2",{id:"appendix-the-wasm-opt-installation-experience"},"Appendix: The ",(0,i.kt)("inlineCode",{parentName:"h2"},"wasm-opt")," installation experience"),(0,i.kt)("p",null,"Upon calling ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract build")," without ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt")," installed\nthe build errors with this long explanation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ERROR: wasm-opt not found! Make sure the binary is in your PATH environment.\n\nWe use this tool to optimize the size of your contract's Wasm binary.\n\nwasm-opt is part of the binaryen package. You can find detailed\ninstallation instructions on https://github.com/WebAssembly/binaryen#tools.\n\nThere are ready-to-install packages for many platforms:\n* Debian/Ubuntu: apt-get install binaryen\n* Homebrew: brew install binaryen\n* Arch Linux: pacman -S binaryen\n* Windows: binary releases at https://github.com/WebAssembly/binaryen/releases\n")),(0,i.kt)("p",null,"Despite the effort to explain how to install this tool,\nfollowing the instructions on our system resulted in an old version of ",(0,i.kt)("inlineCode",{parentName:"p"},"wasm-opt"),"\nand ",(0,i.kt)("inlineCode",{parentName:"p"},"cargo-contract")," produced a new error:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ERROR: Your wasm-opt version is 91, but we require a version >= 99.\n\nIf you tried installing from your system package manager the best\nway forward is to download a recent binary release directly:\n\nhttps://github.com/WebAssembly/binaryen/releases\n\nMake sure that the `wasm-opt` file from that release is in your `PATH`.\n")),(0,i.kt)("p",null,"This actually did about the best that could be expected to help us\nget set up, and we did end up downloading the binary tarball,\nextracting it, and modifying our path.\nBut the experience could be better."))}u.isMDXComponent=!0}}]);